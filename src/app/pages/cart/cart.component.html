<div class="container container-top">
    <div class="row mt-3">
        <div class="col-12">
            <h2 class="text-uppercase fs-4 sb-ls-6">Nákupný košík</h2>

            @if (!productsCount || productsCount === 0) {
            <sb-cart-empty></sb-cart-empty>
            }

            @else {
            <div class="cart-content">
                <!-- Mobile-First Progress Stepper -->
                <div class="mobile-stepper mb-4">
                    <!-- Progress Header -->
                    <sb-progress-header [currentStep]="currentStep" [totalSteps]="totalSteps"
                        stepText="Krok"></sb-progress-header>

                    <!-- Step Cards -->
                    <div class="step-cards">
                        @for (config of stepConfigs; track config.id) {
                        <sb-step-card [config]="getConfigWithSubtitle(config)" [currentStep]="currentStep"
                            [nextButtonDisabled]="isNextButtonDisabled(config.step)"
                            (stepClicked)="setCurrentStep($event)" (nextClicked)="goToNextStep(config.step)"
                            (backClicked)="goToPrevStep(config.step)">

                            @switch (config.step) {
                            @case (CART_STEPS.PRODUCTS) {
                            <sb-cart-products (cartTotalsChanged)="onCartTotalChanged($event)"></sb-cart-products>
                            }
                            @case (CART_STEPS.DELIVERY) {
                            <p class="text-muted small mb-3">Vyberte si spôsob doručenia</p>
                            <sb-packeta (pickupPointSelected)="onPickupPointSelected($event)"
                                (addressSelected)="onAddressSelected($event)"
                                (deliveryTypeChanged)="onDeliveryTypeChanged($event)"></sb-packeta>
                            }
                            @case (CART_STEPS.PAYMENT) {
                            <p class="text-muted small mb-3">Vyberte si spôsob platby</p>
                            TODO
                            }
                            @case (CART_STEPS.FORM) {
                            <sb-cart-finish-order></sb-cart-finish-order>
                            }
                            @case (CART_STEPS.SUMMARY) {
                            <sb-cart-summary [cartTotals]="cartTotals" [productsCount]="productsCount"
                                [freeShippingThreshold]="freeShippingThreshold"
                                (backToDelivery)="setCurrentStep(CART_STEPS.FORM)"></sb-cart-summary>
                            }
                            }
                        </sb-step-card>
                        }
                    </div>
                </div>
            </div>
            }
        </div>
    </div>
</div>